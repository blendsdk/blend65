// @fixture: parser/statements/while-loops/while-with-break
// @category: parser
// @description: Tests parsing of while loops with break statements
// @expect: success
// @output-contains: LDA
// @tags: statements, while, break, loops, control-flow

module WhileWithBreak;

@zp let foundAt: byte = 0;
@zp let iterations: byte = 0;

// Module-level buffer for searching
let buffer: byte[10];

function main(): void {
    // Initialize buffer with test data
    buffer[0] = 1;
    buffer[1] = 3;
    buffer[2] = 5;
    buffer[3] = 7;
    buffer[4] = 9;
    buffer[5] = 11;
    buffer[6] = 13;
    buffer[7] = 15;
    buffer[8] = 17;
    buffer[9] = 19;
    
    // Search for value 9 in buffer
    let idx: byte = 0;
    let target: byte = 9;
    
    while (idx < 10) {
        if (buffer[idx] == target) {
            foundAt = idx;
            break;
        }
        idx = idx + 1;
    }
    
    poke($0400, foundAt);  // Should be 4
    
    // Break from infinite loop pattern
    let count: byte = 0;
    let limit: byte = 20;
    
    while (1 == 1) {
        count = count + 1;
        if (count >= limit) {
            break;
        }
    }
    
    poke($0401, count);  // Should be 20
    
    // Early termination on condition
    let x: byte = 0;
    let sum: byte = 0;
    
    while (x < 100) {
        sum = sum + x;
        x = x + 1;
        // Stop early if sum exceeds threshold
        if (sum > 50) {
            break;
        }
    }
    
    poke($0402, x);
    poke($0403, sum);
}